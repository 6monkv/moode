########################################################
#
# Setup Guide for Multiroom Audio
#
# These instructions are designed for initial configuration
# of a moOde Multiroom Audio system.
#
# Updated: 2021-09-16
#
# (C) Tim Curtis 2021 http://moodeaudio.org
#
#########################################################

OVERVIEW

A moOde multiroom audio system consists of a Sender and one or more Receivers. The
Sender should be a dedicated moOde player configured to output to the integrated
HDMI port or optionally the Headphone jack but not connected to any speakers or
headphones. It functions solely as a Music Server that Sends its audio output to one
or more multiroom Receivers.


BLOCK DIAGRAM

        +---------+
        | Router  |----------------------------+
        +---------+                            |
             |                                 |
             | Ethernet                        |
             |                                 |
         +-------+                             |
         |       | Pi-4, 3B+, 3A+              | Ethernet and/or WiFi 5GHz
         | Sendr | Music Sources               |
         |       | Spotify, Airplay            |
         +-------+                             |
                                               |
                                               |
                                               |
                         +---------------------+---------------------+
                         |                     |                     |
                         |                     |                     |
                         | Pi-4, 3B+, 3A+      |                     |
                     +-------+             +-------+             +-------+
                     |       |             |       |             |       |
                     | Rcvr1 |             | Rcvr2 |             | Rcvr3 |
                     |       |             |       |             |       |
                     +-------+             +-------+             +-------+
                         |                     |                     |
                         |                     | Speakers            |
                       +---+                 +---+                 +---+
                       | . |                 | . |                 | . |
                       | O |                 | O |                 | O |
                       +---+                 +---+                 +---+


RECEIVER CONFIGURATION

Receivers should be configured first. The Receiver player application is separate
from MPD and the Audio Renderers and thus the Receiver configuration should be
dedicated although it's not absolutely required. A Receiver can have Airplay and
Spotify renderers running in the background but there is no coordination between
them and the Receiver player. Initiating a Spotify or Airplay connection while the
Receiver player is ON will result in audio output errors.

A) Audio Configuration (Menu, Configure, Audio)

1. Configure the audio device
2. Set I2S audio device appropriately
3. Set ALSA Loopback to "OFF"
4. EDIT MPD settings
5. Set MPD Audio output appropriately
6. Set SoX Resampling Enabled to "No"
7. Set the following DSP's to "Off"
   - Crossfeed
   - Polarity inversion
   - Graphic EQ
   - Parametric EQ
   - CamillaDSP
8. Set all Audio Renderers to "Off"
9. Set DLNA server to "Off"


SENDER CONFIGURATION

The Sender should be a dedicated computer configured to output to the integrated
HDMI port or optionally the Headphone jack but not connected to any speakers or
headphones. It functions solely as a Music Server that sends its audio output to
one or more multiroom Receivers.

A) Audio Configuration (Menu, Configure, Audio)

1. Set ALSA Output mode to "Default (plughw)"
2. Set ALSA Loopback to "ON"
3. EDIT MPD settings
4. Set MPD Audio output to "HDMI 1"
5. Set SoX Resampling Enabled to "No"
6. Set the following DSP's to "Off"
   - Crossfeed
   - Polarity inversion
   - Graphic EQ
   - Parametric EQ
   - CamillaDSP
7. Set the following Audio Renderers to "Off"
   - Bluetooth
   - Squeezelite
   - RoonBridge
8. Set DLNA server to "Off"

Sender Configuration (Menu, Configure, Multiroom)

1. Set Sender daemon to "ON"
3, Set Initial volume for the Receivers.


NETWORKING AND AUDIO FORMAT

Networking

The performance of the system depends on having low latency, high throughput
networking and hosts. Discovery of Receivers relies on Multicast DNS. Addressing
for the audio distribution protocol relies on IP Multicast using a default
address of 239.0.0.1

Audio format

The system uses 16 bit 48 kHz PCM format encoded using the OPUS CODEC. Resampling
if needed is handled by ALSA using the Speex converter.
