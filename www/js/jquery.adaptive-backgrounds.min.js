/*! jshint debug: true, expr: true */

/* 2018-07-11 TC moOde 4.2
 * - css vars, other css for newui v2
 * - adj method for dominance
 * - clean up tabbing
 * 2018-09-27 TC moOde 4.3
 * - minor fixes
 * 2018-12-09 TC moOde 4.4
 * - improvements for btnBarFix()
 * 2019-05-30 TC moOde 5.3
 * - Add parseInt to getYiq()
 *
 * 2020-MM-DD TC moOde 7.0.0
 */

 !function(a){var r={selector:"[data-adaptive-background]",parent:"#playback-panel",exclude:["rgb(0,0,0)","rgb(255,255,255)"],shadeVariation:"blend",shadePercentage:.15,shadeColors:{light:"rgb(128,128,128)",dark:"rgb(224,224,224)"},normalizeTextColor:!0,normalizedTextColors:{light:"#eee",dark:"#333"},lumaClasses:{light:"ab-light",dark:"ab-dark"},transparent:null};function e(a,r){var e=a.split(","),t=r<0?0:255,n=r<0?-1*r:r,o=parseInt(e[0].slice(4)),c=parseInt(e[1]),s=parseInt(e[2]);return"rgb("+(Math.round((t-o)*n)+o)+","+(Math.round((t-c)*n)+c)+","+(Math.round((t-s)*n)+s)+")"}function t(a,r,e){var t=a.split(","),n=r.split(","),o=parseInt(t[0].slice(4)),c=parseInt(t[1]),s=parseInt(t[2]);return"rgb("+(Math.round((parseInt(n[0].slice(4))-o)*e)+o)+","+(Math.round((parseInt(n[1])-c)*e)+c)+","+(Math.round((parseInt(n[2])-s)*e)+s)+")"}!function(a,r){"use strict";var e=function(a,r){var e=new Image,t=a.src||a;"data:"!==t.substring(0,5)&&(e.crossOrigin="Anonymous"),e.onerror=function(){adaptMcolor=themeMcolor,adaptMback=themeMback,adaptColor=themeColor,adaptBack=themeBack},e.onload=function(){var a=document.createElement("canvas").getContext("2d");a.drawImage(e,0,0);var t=a.getImageData(0,0,e.width,e.height);r&&r(t.data)},e.src=t},t=function(a){return["rgb(",a,")"].join("")},n={};n.colors=function(a,r){var n=(r=r||{}).exclude||[],o=r.paletteSize||10;e(a,function(e){for(var c=a.width*a.height||e.length,s={},l="",i=[],d={dominant:{name:"",count:0},palette:Array.apply(null,new Array(o)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},u=0;c>u;){if(i[0]=e[u],i[1]=e[u+1],i[2]=e[u+2],s[l=i.join(",")]=l in s?s[l]+1:1,-1===n.indexOf(t(l))){var p=s[l];p>d.dominant.count?(d.dominant.name=l,d.dominant.count=p):d.palette.some(function(a){return p>a.count?(a.name=l,a.count=p,!0):void 0})}u+=20}if(r.success){var g=function(a){return a.map(function(a){return t(a.name)})}(d.palette);"rgb(0,0,0)"==g[1]&&(g[0]=t(d.dominant.name)),"rgb(255,255,255)"==g[0]&&(g[0]=g[1]);var b=rgbToHsl(g[0]),m=rgbToHsl(g[1]),h=rgbToHsl(t(d.dominant.name)),f=0,v=0;b[2]>m[2]?(f=0,v=1):(f=1,v=0),h[2]+.2>b[2]&&h[2]<".98"&&(g[0]=t(d.dominant.name),f=0,v=1),"rgb(255,255,255)"==t(d.dominant.name)&&"rgb(0,0,0)"==g[1]&&(g[0]=t(d.dominant.name),f=0,v=1),h[2]>.98&&(f=0,v=1),r.success({dominant:g[f],secondary:g[v],palette:g})}})},a.RGBaster=a.RGBaster||n}(window),a.adaptiveBackground={run:function(n){var o=a.extend({},r,n);abfound="false",a(o.selector).each(function(r,n){var c=a(this),s=function(a){var r=a.match(/\d+/g);return parseInt((299*r[0]+587*r[1]+114*r[2])/1e3)},l=function(){var a=c.attr("data-ab-css-background");return void 0!==a&&!1!==a},i=function(){var a=c.css("background-image");return/\(([^)]+)\)/.exec(a)[1].replace(/"/g,"")};c.on("ab-color-found",function(r,n){var i,d;if(i=o.parent&&c.parents(o.parent).length?c.parents(o.parent):c.attr("data-ab-parent")&&c.parents(c.attr("data-ab-parent")).length?c.parents(c.attr("data-ab-parent")):l()?c:o.parent?c.parents(o.parent):c.parent(),o.shadeVariation&&(n.color=("rgb()"!=(d=n.color)&&"rgb(,,)"!=d||(d="rgb(0,0,0)"),1==o.shadeVariation?s(d)<=128?e(d,o.shadePercentage):e(d,-o.shadePercentage,o.shadePercentage):"blend"==o.shadeVariation?s(d)>=128?t(d,o.shadeColors.dark,o.shadePercentage):t(d,o.shadeColors.light,o.shadePercentage):void 0)),a.isNumeric(o.transparent)&&null!=o.transparent&&o.transparent>=.01&&o.transparent<=.99){var u=n.color.replace("rgb","rgba").replace(")",", "+o.transparent+")");i.css({backgroundColor:u})}var p=rgbToHsl(n.color),g=p[2],b=n.color;g<.1?p[2]=g+.03:g<.45&&g>.35&&(p[2]=g-.05);var m=hslToRgb(p),h=(b="rgba(","rgba(");abFound="true",b=b.concat(m[0],",",m[1],",",m[2],","+SESSION.json.alphablend+")"),h=h.concat(m[0],",",m[1],",",m[2],","+themeOp+")"),n.color=b,adaptBack=b;m=hslToRgb(p);var f="rgba(";f=f.concat(m[0],",",m[1],",",m[2],",",themeOp,")"),adaptMback=f,adaptMhalf="rgba(".concat(m[0],",",m[1],",",m[2],",0.5)");o.normalizeTextColor&&(adaptMcolor=function(a){return s(a)>=128?o.normalizedTextColors.dark:o.normalizedTextColors.light}(n.color),adaptColor=adaptMcolor,"Yes"==SESSION.json.adaptive&&setColors()),o.success&&o.success(c,n)}),function(){if("PICTURE"==c[0].tagName){var a=c[0].children;for(var r in a)if("IMG"==a[r].tagName){var e=a[r];break}e.currentSrc&&(e=e.currentSrc)}else e=l()?i():c[0];RGBaster.colors(e,{paletteSize:20,exclude:o.exclude,success:function(a){c.attr("data-ab-color",a.dominant),c.trigger("ab-color-found",{color:a.dominant,palette:a.palette})}})}()})}}}(jQuery);
